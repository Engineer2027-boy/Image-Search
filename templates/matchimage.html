<!DOCTYPE html>
<html>
<head>
<meta = "UTF-8">
<title>Match two images</title>
<style>
     .background{
	position : fixed;
	top : 0;
	left : 0;
	padding : 0;
	margin : 0;
        height : 100vh;
	width : 100%;
	background : url('/static/images/graph_paper.png') no-repeat center center fixed;
	background-size : cover;
     }
     .upload-image-1 {
       position: absolute;
       border: 4px solid #0CC405;
       width: 288px;
       height: 70px;
       padding: 20px;
       top: 350px;
       left: 195px;
       background-color: black;
       color: white;
       font-size: 18px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor : pointer;                
    }
    .upload-image-2{
       position: absolute;
       border: 4px solid #0CC405;
       width: 288px;
       height: 70px;
       padding: 20px;
       top: 350px;
       left: 1060px;
       background-color: black;
       color: white;
       font-size: 18px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor : pointer;                
    }
    .button-3{
       position: absolute;
       border: 4px solid #0CC405;
       width: 288px;
       height: 70px;
       padding: 20px;
       top: 640px;
       left: 627px;
       background-color: black;
       color: white;
       font-size: 18px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor :  pointer;                  
    }
    .cancel-button-1{
       position: absolute;
       border: 4px solid #0CC405;
       width: 140px;
       height: 100px;
       padding: 20px;
       top: 0px;
       left: 1060px;
       background-color: black;
       color: white;
       font-size: 45px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor :  pointer;
       display : none;                  
    }
    .cancel-button-2{
       position: absolute;
       border: 4px solid #0CC405;
       width: 140px;
       height: 100px;
       padding: 20px;
       top: 00px;
       left: 340px;
       background-color: black;
       color: white;
       font-size: 45px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor :  pointer; 
       display : none;                 
    }
     .logo{
	width : 25px;
	height : 25px;
    }
    .img{
	max-width : 150px;
	margin : 10px;
	display : block;
    }
    .hidden-input{
	display : none;
    }
    .input[type="file"]{
	display : none;
    }
    .visible-image{
        position  : absolute;
	width : 430px;
	height : 430px;
	top : 102px;
	left : 195px;
        display : flex;
    }
    .visible-image-2{
        position  : absolute;
	width : 430px;
	height : 430px;
	top : 102px;
	left : 915px;
	display : flex;
    }
    .cancel-symbol{
	width : 60px;
        height : 60px;
     }
     .result{
       position: absolute;
       top: 640px;
       left: 627px;
       color: white;
       font-size: 25px;
       display: none;                     
       cursor :  pointer; 
       border: 4px solid #0CC405;
       background-color: black;
       border-radius : 10px;
       width: 288px;
       height: 70px;
       align-items : center;
    }

</style>
</head>
<body>
<div class = "background">
     <form action="/" method = "POST" enctype="multipart/form-data">
     <button type = "button" class = "upload-image-1" onclick="document.getElementById('file1').click()">
	<img src = "{{ url_for('static', filename ='images/image_logo.png')}}" alt = "button-text" class = "logo">
	Upload the first image here
     </button>
     <input type="file" id="file1" name="image-1" class="hidden-input" accept="image/*" onchange="previewImage(event, this, 1)">
     </form>
     <img id="previewImage">
     <form action="/" method = "POST" enctype="multipart/form-data">
     <button type="button" class = "upload-image-2" onclick = "document.getElementById('file2').click()">
	<img src = "{{ url_for('static', filename = 'images/image_logo.png')}}" alt = "button-text" class = "logo">
	Upload the second image here
     </button>
     <input type="file" id="file2" name="image-2" class="hidden-input" accept="image/*" onchange="previewImage2(event, this, 2)">
     </form>
     <img id="previewImage2">
     <button type = "button" class = "button-3" onclick="postImage()">
	Click here to find similarity.
     </button>
     <div id="result" class="result"></div>
     <button class = "cancel-button-1", style="padding-left : 50px;", onclick="removeImage1()">
	X 
     </button>
     <button class = "cancel-button-2", style="padding-left : 50px;", onclick="removeImage2()">
	X
     </button>
</div>
<script>
  let upload = {1: false, 2: false};

  function previewImage(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      const img = document.getElementById("previewImage");
      img.src = e.target.result;
      img.className = "visible-image";
      document.querySelector(".cancel-button-2").style.display = "flex";
      upload[1] = true; // first image present
    };
    reader.readAsDataURL(file);
  }

  function previewImage2(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      const img = document.getElementById("previewImage2");
      img.src = e.target.result;
      img.className = "visible-image-2";
      document.querySelector(".cancel-button-1").style.display = "flex";
      upload[2] = true; // second image present
    };
    reader.readAsDataURL(file);
  }
      function removeImage1(){
        if (upload[2]) {
            upload[2] = false;
            document.querySelector(".cancel-button-1").style.display = "none";
            const img = document.getElementById("previewImage2");
            if (img) {
                img.remove();
                const form = document.querySelectorAll("form")[1]; 
                const newButton = document.createElement("button");
                newButton.type = "button";
                newButton.className = "upload-image-2";
                newButton.innerHTML = `<img src="{{ url_for('static', filename = 'images/image_logo.png')}}" class="logo"> Upload the second image here`;
                newButton.onclick = () => document.getElementById("file2").click();
                form.insertBefore(newButton, form.firstChild);
            }
        }
    }
    function removeImage2(){
        if (upload[1]) {
            upload[1] = false;
            document.querySelector(".cancel-button-2").style.display = "none";
            const img = document.getElementById("previewImage");
            if (img) {
                img.remove();
                const form = document.querySelectorAll("form")[0];
                const newButton = document.createElement("button");
                newButton.type = "button";
                newButton.className = "upload-image-1";
                newButton.innerHTML = `<img src="{{ url_for('static', filename ='images/image_logo.png')}}" class="logo"> Upload the first image here`;
                newButton.onclick = () => document.getElementById("file1").click();
                form.insertBefore(newButton, form.firstChild);
            }
        }
    }
  async function postImage() {
    const img = document.getElementById("previewImage")?.src;
    const img1 = document.getElementById("previewImage2")?.src;

    if (!img || !img1) {
      alert("Please upload both images first!");
      return;
    }

    const response = await fetch("/compare", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ image1: img, image2: img1 })
    });

    const data = await response.json();
    document.querySelector('.button-3').style.display = "none";
    document.querySelector('.result').style.display = "flex";

    document.getElementById("result").innerText = "Similarity: " + data.similarity + "%";
     if (data.similarity < 25 && data.similarity >= 0) {
      alert("It's not similar at all");
      return;
    }else if(data.similarity < 50 && data.similarity >= 25){
      alert("There is a little bit of similarity between the two images");
      return;
    }else if(data.similarity >= 50 && data.similarity < 75){
      alert("There is a lot of similarity between the two images");
      return;
    }else{
      alert("The images are extremely similar");
      return;
    }
  }
</script>
</body>
</html>
