<!DOCTYPE html>
<html>
<head>
<meta = "UTF-8">
<title>Match two images</title>
<style>
     .background{
	position : fixed;
	top : 0;
	left : 0;
	padding : 0;
	margin : 0;
        height : 100vh;
	width : 100%;
	background : url('/static/images/graph_paper.png') no-repeat center center fixed;
	background-size : cover;
     }
     .upload-image-1 {
       position: absolute;
       border: 4px solid #0CC405;
       width: 288px;
       height: 70px;
       padding: 20px;
       top: 350px;
       left: 195px;
       background-color: black;
       color: white;
       font-size: 18px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor : pointer;                
    }
    .upload-image-2{
       position: absolute;
       border: 4px solid #0CC405;
       width: 288px;
       height: 70px;
       padding: 20px;
       top: 350px;
       left: 1060px;
       background-color: black;
       color: white;
       font-size: 18px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor : pointer;                
    }
    .button-3{
       position: absolute;
       border: 4px solid #0CC405;
       width: 288px;
       height: 70px;
       padding: 20px;
       top: 640px;
       left: 627px;
       background-color: black;
       color: white;
       font-size: 18px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor :  pointer;                  
    }
    .cancel-button-1{
       position: absolute;
       border: 4px solid #0CC405;
       width: 140px;
       height: 100px;
       padding: 20px;
       top: 0px;
       left: 1060px;
       background-color: black;
       color: white;
       font-size: 45px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor :  pointer;
       display : none;                  
    }
    .cancel-button-2{
       position: absolute;
       border: 4px solid #0CC405;
       width: 140px;
       height: 100px;
       padding: 20px;
       top: 00px;
       left: 340px;
       background-color: black;
       color: white;
       font-size: 45px;
       display: flex;              
       align-items: center;        
       gap: 10px;
       border-radius : 10px;
       cursor :  pointer; 
       display : none;                 
    }
     .logo{
	width : 25px;
	height : 25px;
    }
    .img{
	max-width : 150px;
	margin : 10px;
	display : block;
    }
    .hidden-input{
	display : none;
    }
    .input[type="file"]{
	display : none;
    }
    .visible-image{
        position  : absolute;
	width : 430px;
	height : 430px;
	top : 102px;
	left : 195px;
        display : flex;
    }
    .visible-image-2{
        position  : absolute;
	width : 430px;
	height : 430px;
	top : 102px;
	left : 915px;
	display : flex;
    }
    .cancel-symbol{
	width : 60px;
        height : 60px;
     }
</style>
</head>
<body>
<div class = "background">
     <form action="/" method = "POST" enctype="multipart/form-data">
     <button type = "button" class = "upload-image-1" onclick="document.getElementById('file1').click()">
	<img src = "{{ url_for('static', filename ='images/image_logo.png')}}" alt = "button-text" class = "logo">
	Upload the first image here
     </button>
     <input type="file" id="file1" name="image-1" class="hidden-input" accept="image/*" onchange="previewImage(event, this, 1)">
     </form>
     <img id="previewImage">
     <form action="/" method = "POST" enctype="multipart/form-data">
     <button type="button" class = "upload-image-2" onclick = "document.getElementById('file2').click()">
	<img src = "{{ url_for('static', filename = 'images/image_logo.png')}}" alt = "button-text" class = "logo">
	Upload the second image here
     </button>
     <input type="file" id="file2" name="image-2" class="hidden-input" accept="image/*" onchange="previewImage2(event, this, 2)">
     </form>
     <img id="previewImage2">
     <button class = "button-3" onclick="postImage()">
	Click here to find similarity.
     </button>
     <button class = "cancel-button-1", style="padding-left : 50px;", onclick="removeImage1()">
	X 
     </button>
     <button class = "cancel-button-2", style="padding-left : 50px;", onclick="removeImage2()">
	X
     </button>
</div>
<script>
    let upload = {1 : false, 2 : false};
    function previewImage(event, input, num){
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e){
                const img = document.createElement("img");
                img.src = e.target.result;
                img.className = "visible-image";
                img.id = "preview1"; // give ID for easy removal
                const button = input.previousElementSibling;
                button.replaceWith(img);
                document.querySelector(".cancel-button-2").style.display = "flex";
                upload[2] = true;
            };
            reader.readAsDataURL(file); 
        }
    }
    function previewImage2(event, input){
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e){
                const img = document.createElement("img");
                img.src = e.target.result;
                img.className = "visible-image-2";
                img.id = "preview2"; // give ID for easy removal
                const button = input.previousElementSibling;
                button.replaceWith(img);
                document.querySelector(".cancel-button-1").style.display = "flex";
                upload[1] = true;
            };
            reader.readAsDataURL(file); 
        }
    }
    function removeImage1(){
        if (upload[1]) {
            upload[1] = false;
            document.querySelector(".cancel-button-1").style.display = "none";
            const img = document.getElementById("preview2");
            if (img) {
                img.remove();
                const form = document.querySelectorAll("form")[1]; 
                const newButton = document.createElement("button");
                newButton.type = "button";
                newButton.className = "upload-image-2";
                newButton.innerHTML = `<img src="{{ url_for('static', filename = 'images/image_logo.png')}}" class="logo"> Upload the second image here`;
                newButton.onclick = () => document.getElementById("file2").click();
                form.insertBefore(newButton, form.firstChild);
            }
        }
    }
    function removeImage2(){
        if (upload[2]) {
            upload[2] = false;
            document.querySelector(".cancel-button-2").style.display = "none";
            const img = document.getElementById("preview1");
            if (img) {
                img.remove();
                const form = document.querySelectorAll("form")[0];
                const newButton = document.createElement("button");
                newButton.type = "button";
                newButton.className = "upload-image-1";
                newButton.innerHTML = `<img src="{{ url_for('static', filename ='images/image_logo.png')}}" class="logo"> Upload the first image here`;
                newButton.onclick = () => document.getElementById("file1").click();
                form.insertBefore(newButton, form.firstChild);
            }
        }
    }
    async function postImage(){
	let img = document.getElementbyId("previewImage").src;
	let img1 = document.getElementbyId("previewImage2").src;
        let response = await fetch("/compare", {
	    method : "POST",
	    headers : {"Content-Type" : "application/json"},
	    body : JSON.stringify({image1 : img, image2 : img1})
        });
	let data = await response.json();
	document.getElementById("result").innerText = "Similiarity: " + data.similarity + "%"; 
    }
    
</script>
</body>
</html>
